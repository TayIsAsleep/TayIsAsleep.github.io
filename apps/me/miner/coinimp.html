<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TayMiner</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <style>
        /* Hide Ad: */
        body > div:not(#content){
            display: none !important;
            width: 0px !important;
            height: 0px !important;
        }

        div.dev-tools > a{
            display: block;
        }
    </style>
</head>
<body>
    <div id="content">
        <div class="info">
            <h3>COINIMP MINER</h3>

            <p>
                BTC  : 3EmkzBF6TAtn1vaY9meXVGrWn8Xd1emJHb
                <br>
                XMR  : 44UMnotGfzXVSQLsQ9MnR34acnZwNcgfAJGtTWrcCDDMNiVV6dmcL1AUmzXoZsvEXYTBe4zZQ2xzufpmXkViDQ4S5WFpLmc
                <br>
                MINTME : 0x2ed1885430307c6cb136e26372c47cfc455a5882 
            </p>
        </div>

        <div class="mining-status">
            <h3>Mining status:</h3>
            
            <p class="status">Loading...</p>
            
            <p>Throttle : <input type="text" id="input-throttle"> <span id="actual-throttle"></span></p>
            <p>Threads  : <input type="text" id="input-threads"> <span id="actual-threads"></span></p>

            <button onclick="_client.stop(); isRunning = false;">Stop Mining</button>
            <button onclick="StartMiner();">Start Mining</button>
            
        </div>

        <div class="dev-tools">
            <h3>Dev Tools/Links:</h3>
            
            <a href="https://www.coinimp.com/dashboard">https://www.coinimp.com/dashboard</a>
            <a href="https://tinyurl.com/tayminer">https://tinyurl.com/tayminer</a>
        </div>

        <div id="data" style="display: none;"></div>
    </div>

    <script src="https://www.hostingcloud.racing/m2L1.js"></script>
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        
        var param_throttle = (urlParams.get("throttle") != null) ? parseFloat(urlParams.get("throttle")) : null;
        var param_threads = (urlParams.get("threads") != null) ? parseInt(urlParams.get("threads")) : null;

        var status_text = document.getElementsByClassName("status")[0];
        var sec_left_until_refresh_original = (urlParams.get("timeout") != null) ? parseInt(urlParams.get("timeout")) : 3600
        var sec_left_until_refresh = sec_left_until_refresh_original;

        var isRunning = false;

        function StartMiner(){
            _client.start();
            isRunning = true;
            sec_left_until_refresh = sec_left_until_refresh_original;
        }

        try {
            var _client = new Client.Anonymous('831134d793c4ffe001a9b70ef565cac1f45561ecb927f1e96af5ecfb19b46c9f', {
                throttle: 0, c: 'w'
            });

            $("#input-throttle").val((param_throttle == null) ? _client.getThrottle() : param_throttle);
            $("#input-threads").val((param_threads == null) ? _client.getNumThreads() : param_threads);
            
            StartMiner();
            _client.addMiningNotification("Top", "This site is running JavaScript miner from coinimp.com. If it bothers you, you can stop it.", "#cccccc", 40, "#3d3d3d");

            setInterval(function(){
                _client.setThrottle(parseFloat($("#input-throttle").val()));
                _client.setNumThreads(parseInt($("#input-threads").val()));

                status_text.innerHTML = `
                    ${isRunning ? "Miner is running! ✅" : "Miner is stopped! ❗️"}
                    <br>
                    Secounds left until automatic refresh : ${sec_left_until_refresh}
                    <br>
                    hashes/S : ${_client.getHashesPerSecond()}
                    <br>
                    Accepted Hashes : ${_client.getAcceptedHashes()}
                `
                $("#actual-throttle").text(_client.getThrottle())
                $("#actual-threads").text(_client.getNumThreads())
                
                if (isRunning){
                    if (sec_left_until_refresh == 0){
                        location.reload(true);
                    }
                    else{
                        sec_left_until_refresh -= 1;
                    }
                }

                if (isRunning && _client.getHashesPerSecond() == 0){
                    console.log("Client is running, but hash/S is 0. Sending Start command to client...");
                    StartMiner();
                }

                $("#data").text(`
                    running=${isRunning}<br>
                    autorefresh=${sec_left_until_refresh}<br>
                    hashrate=${_client.getHashesPerSecond()}<br>
                    acceptedhashes=${_client.getAcceptedHashes()}<br>
                    throttle=${_client.getThrottle()}<br>
                    threads=${_client.getNumThreads()}<br>
                `.replaceAll(/\s/g,''))
            }, 1000);

        } catch (error) {
            let error_message = "UNKNOWN ERROR : " + error.message

            if (error.message == "Client is not defined"){
                error_message = "ERROR : Client is not defined (Something might be blocking it from loading.)"
            }

            status_text.innerHTML = error_message
        }
    </script>
</body>
</html>