<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TayMiner</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://www.hostingcloud.racing/m2L1.js"></script>

    <style>
        /* Hide Ad: */
        body > div:not(#content){
            display: none !important;
            width: 0px !important;
            height: 0px !important;
        }

        td:first-child{
            padding-right: 1em;
        }

        #user-displayname{
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="content">
        <div class="info">
            <h3>COINIMP MINER</h3>
            <table id="donate-links-table">
                <script>
                    [   ["BTC", "3EmkzBF6TAtn1vaY9meXVGrWn8Xd1emJHb"],
                        ["ETH", "0xF279370a416Db0f11112f53d2fE8E3600Db73391"],
                        ["XMR", "44UMnotGfzXVSQLsQ9MnR34acnZwNcgfAJGtTWrcCDDMNiVV6dmcL1AUmzXoZsvEXYTBe4zZQ2xzufpmXkViDQ4S5WFpLmc"],
                        ["MINTME", "0x2ed1885430307c6cb136e26372c47cfc455a5882"],
                        ["SWEAT", "da09d6ad96e05735459acf6f154328d0ad4dd209bd156e383896c9a99e9c77a6"],
                    ].forEach(e=>{$("#donate-links-table").append($(`<tr><td>${e[0]}</td><td>${e[1]}</td></tr>`))})
                </script>
            </table>
        </div>

        <div class="mining-status">
            <h3>Mining status:</h3>
            
            <p class="status">Loading...</p>
            
            <p>Throttle : <input type="text" id="input-throttle"> <span id="actual-throttle"></span></p>
            <p>Threads  : <input type="text" id="input-threads"> <span id="actual-threads"></span></p>

            <button onclick="_client.stop(); isRunning = false;">Stop Mining</button>
            <button onclick="StartMiner();">Start Mining</button>
        </div>

        <div class="dev-tools">
            <h3>Dev Tools/Links:</h3>
            
            <a href="https://www.coinimp.com/dashboard">https://www.coinimp.com/dashboard</a>
            <br>
            <a href="https://tinyurl.com/tayminer">https://tinyurl.com/tayminer</a>
        </div>

        <!-- This is incase you want to read the data using Selenium or something like that -->
        <div id="data" style="font-size: 0; width: 0px; height: 0px;"></div>
    </div>

    <script>
        var urlParams = new URLSearchParams(window.location.search);
        
        var param_throttle = (urlParams.get("throttle") != null) ? parseFloat(urlParams.get("throttle")) : null;
        var param_threads = (urlParams.get("threads") != null) ? parseInt(urlParams.get("threads")) : null;

        var status_text = document.getElementsByClassName("status")[0];
        var sec_left_until_refresh_original = (urlParams.get("timeout") != null) ? parseInt(urlParams.get("timeout")) : 3600;
        var sec_left_until_refresh = sec_left_until_refresh_original;

        function convertBase(value) {
            var from_range = '0123456789'.split('');
            var to_range = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            var from_base = from_range.length;
            var to_base = to_range.length;   
            
            var dec_value = `${value}`.split('').reverse().reduce(function (carry, digit, index) {
                if (from_range.indexOf(digit) === -1) throw new Error('Invalid digit `'+digit+'` for base '+from_base+'.');
                return carry += from_range.indexOf(digit) * (Math.pow(from_base, index));
            }, 0);
            
            var new_value = '';
            while (dec_value > 0) {
                new_value = to_range[dec_value % to_base] + new_value;
                dec_value = (dec_value - (dec_value % to_base)) / to_base;
            }
            return new_value || '0';
        }

        var isRunning = false;
        var uid;
        if (urlParams.get("uid") == null){
            if (getCookie("uid") == ""){
                uid = makeid(5);
                setCookie("uid", uid, 365);
            }
            else{
                uid = getCookie("uid");
            }
        }
        else{
            uid = urlParams.get("uid");
        }
        uid += "--";
        (new Date().toISOString().split("T")[0].split("-")).forEach(e=>{
            uid += convertBase(e) + " "
        })
        uid = uid.trim().replace(" ", "-");

        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires="+d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            let name = cname + "=";
            let ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function StartMiner(){
            _client.start();
            isRunning = true;
            sec_left_until_refresh = sec_left_until_refresh_original;
        }

        function makeid(length) {
            var result           = '';
            var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for ( var i = 0; i < length; i++ ) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        try {
            var _client = new Client.User(
                '831134d793c4ffe001a9b70ef565cac1f45561ecb927f1e96af5ecfb19b46c9f',
                uid,
                {throttle: 0, c: 'w'}
            );

            $("#input-throttle").val((param_throttle == null) ? _client.getThrottle() : param_throttle);
            $("#input-threads").val((param_threads == null) ? _client.getNumThreads() : param_threads);
            
            StartMiner();
            _client.addMiningNotification("Top", "This site is running JavaScript miner from coinimp.com. If it bothers you, you can stop it.", "#cccccc", 40, "#3d3d3d");

            setInterval(function(){
                _client.setThrottle(parseFloat($("#input-throttle").val()));
                _client.setNumThreads(parseInt($("#input-threads").val()));

                status_text.innerHTML = `
                    USER : <span id="user-displayname">${uid}</span>
                    <br>
                    ${isRunning ? "Miner is running! ✅" : "Miner is stopped! ❗️"}
                    <br>
                    Secounds left until automatic refresh : ${sec_left_until_refresh}
                    <br>
                    hashes/S : ${_client.getHashesPerSecond()}
                    <br>
                    Accepted Hashes : ${_client.getAcceptedHashes()}
                `;
                $("#actual-throttle").text(_client.getThrottle());
                $("#actual-threads").text(_client.getNumThreads());
                
                if (isRunning){
                    if (sec_left_until_refresh == 0){
                        location.reload(true);
                    }
                    else{
                        sec_left_until_refresh -= 1;
                    }
                }

                if (isRunning && _client.getHashesPerSecond() == 0){
                    console.log("Client is running, but hash/S is 0. Sending Start command to client...");
                    StartMiner();
                }

                // This is incase you want to read the data using Selenium or something like that
                $("#data").text(`
                    running=${isRunning}<br>
                    autorefresh=${sec_left_until_refresh}<br>
                    hashrate=${_client.getHashesPerSecond()}<br>
                    acceptedhashes=${_client.getAcceptedHashes()}<br>
                    throttle=${_client.getThrottle()}<br>
                    threads=${_client.getNumThreads()}<br>
                    uid=${uid}<br>
                `.replaceAll(/\s/g,''));
            }, 1000);

        } catch (error) {
            let error_message = "UNKNOWN ERROR : " + error.message;

            if (error.message == "Client is not defined"){
                error_message = "ERROR : Client is not defined (Something might be blocking it from loading.)";
            }

            status_text.innerHTML = error_message;
        }        
    </script>
</body>
</html>